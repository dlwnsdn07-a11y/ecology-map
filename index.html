<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>ì„œìš¸êµìœ¡ëŒ€í•™êµ ìƒíƒœì§€ë„ Â· 3D</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.js"></script>
<style>
  *{box-sizing:border-box;}
  html,body{margin:0;height:100%;font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",sans-serif;}
  #map{width:100%;height:100%;}

  .marker{
    width:34px;height:34px;border-radius:50%;
    background:#fff;border:2px solid #222;display:flex;align-items:center;justify-content:center;
    font-size:20px;box-shadow:0 2px 6px rgba(0,0,0,.2);cursor:pointer;
  }
  .marker.tree{border-color:#2e7d32}
  .marker.conifer{border-color:#1b5e20}
  .marker.shrub{border-color:#558b2f}
  .marker.flower{border-color:#c2185b}
  .marker.herb{border-color:#6a1b9a}
  .marker.grass{border-color:#00796b}
  .marker.vine{border-color:#2e7d32}
  .marker.insect{border-color:#f57c00}
  .marker.spider{border-color:#6d4c41}
  .marker.animal{border-color:#455a64}

  .popup{max-width:320px;font-size:14px;line-height:1.55;}
  .popup h3{margin:0 0 6px;font-size:16px;}
  .popup img{width:100%;border-radius:8px;margin:6px 0;}
  .popup .tags span{
    display:inline-block;padding:2px 6px;border:1px solid #ddd;border-radius:999px;
    font-size:12px;margin-right:4px;margin-top:4px;background:#f7f7f7;
  }

  .legend{
    position:absolute;left:10px;top:10px;z-index:50;
    background:#fff;border:1px solid #ccc;border-radius:10px;padding:10px 12px;font-size:13px;
    box-shadow:0 2px 8px rgba(0,0,0,.15);
  }
  .legend-row{display:flex;align-items:center;gap:6px;margin:4px 0;}
  .legend .dot{
    width:20px;height:20px;border-radius:50%;border:2px solid #222;
    display:flex;align-items:center;justify-content:center;font-size:14px;
  }
  .dot.tree{border-color:#2e7d32}.dot.conifer{border-color:#1b5e20}.dot.shrub{border-color:#558b2f}
  .dot.flower{border-color:#c2185b}.dot.herb{border-color:#6a1b9a}.dot.grass{border-color:#00796b}
  .dot.vine{border-color:#2e7d32}.dot.insect{border-color:#f57c00}.dot.spider{border-color:#6d4c41}.dot.animal{border-color:#455a64}

  /* ë²„íŠ¼ UI */
  #tour-ui{
    position:absolute;right:10px;top:10px;z-index:9999;
    display:flex;flex-direction:column;gap:6px;
  }
  #tour-ui button{
    padding:8px 12px;border-radius:8px;border:1px solid #ccc;background:#ffffffd9;cursor:pointer;
  }
  #btn-tour-stop{background:#fff3f3;border-color:#f55;}
</style>
</head>
<body>

<div id="map"></div>

<!-- íˆ¬ì–´ ë²„íŠ¼ (ì¤‘ë³µ ì—†ìŒ / ìµœì¢…ë³¸) -->
<div id="tour-ui">
  <button id="btn-tour-A">â–¶ A ë£¨íŠ¸ (ìƒíƒœ ë¶„ë¥˜)</button>
  <button id="btn-tour-B">â–¶ B ë£¨íŠ¸ (ìœ„ì¹˜ ê¸°ë°˜)</button>
  <button id="btn-tour-stop">â–  ì •ì§€</button>
</div>

<!-- ë²”ë¡€ -->
<div class="legend">
  <div class="legend-row"><span class="dot conifer">ğŸŒ²</span> ì¹¨ì—½ìˆ˜</div>
  <div class="legend-row"><span class="dot tree">ğŸŒ³</span> í™œì—½ êµëª©</div>
  <div class="legend-row"><span class="dot shrub">ğŸŒ¿</span> ê´€ëª©</div>
  <div class="legend-row"><span class="dot flower">ğŸŒ¸</span> ê½ƒ/í™”ëª©</div>
  <div class="legend-row"><span class="dot herb">ğŸª´</span> ì´ˆë³¸</div>
  <div class="legend-row"><span class="dot grass">ğŸŒ¾</span> ì”ë””/ë²¼ê³¼</div>
  <div class="legend-row"><span class="dot vine">ğŸ§µ</span> ë©êµ´</div>
  <div class="legend-row"><span class="dot insect">ğŸ›</span> ê³¤ì¶©</div>
  <div class="legend-row"><span class="dot spider">ğŸ•·ï¸</span> ê±°ë¯¸</div>
  <div class="legend-row"><span class="dot animal">ğŸ±</span> ë™ë¬¼</div>
</div>

<script>
/* 1) í† í° & ì§€ë„ */
mapboxgl.accessToken = 'pk.eyJ1IjoianVudXV1dSIsImEiOiJjbWg1OXI2enEwNXJiMmlyM2txdHBjNmNwIn0.HdqWmsUAAzUdtbIOmHoSvg';

const map = new mapboxgl.Map({
  container:'map',
  style:'mapbox://styles/mapbox/light-v11',
  center:[127.0160,37.4899],
  zoom:18,
  pitch:60,
  bearing:-20
});

map.on('style.load',()=>{
  const labelLayer = map.getStyle().layers.find(l=>l.type==='symbol' && l.layout?.["text-field"]);
  map.addLayer({
    id:'3d-buildings',
    source:'composite',
    'source-layer':'building',
    filter:['==','extrude','true'],
    type:'fill-extrusion',
    minzoom:15,
    paint:{
      'fill-extrusion-color':'#a7b0b5',
      'fill-extrusion-height':['interpolate',['linear'],['zoom'],15,0,15.05,['get','height']],
      'fill-extrusion-base':['interpolate',['linear'],['zoom'],15,0,15.05,['get','min_height']],
      'fill-extrusion-opacity':0.7
    }
  },labelLayer?.id);
});

map.on('click',e=>console.log('clicked:',e.lngLat));

/* 2) ì „ì—­ ì €ì¥ì†Œ */
const markers = [];
const markerByName = {};

/* 3) ë¶„ë¥˜ ë§¤í•‘ */
const typeToClass = {
  tree:'tree', conifer:'conifer', shrub:'shrub', flower:'flower',
  herb:'herb', grass:'grass', vine:'vine', insect:'insect',
  spider:'spider', animal:'animal'
};

/* 4) ë°ì´í„° (31ì¢…) */
const items = [
  { name:'ì€í–‰ë‚˜ë¬´', type:'tree', emoji:'ğŸŒ³', lng:127.01648751953951, lat:37.48950022789272, img:'images/ì€í–‰ë‚˜ë¬´.jpg',
    desc:'ì€í–‰ë‚˜ë¬´(Ginkgo biloba)ëŠ” ê³µí•´Â·í•œë­Â·ë³‘í•´ì— ê°•í•œ ë‚™ì—½ êµëª©ìœ¼ë¡œ, ë¶€ì±„ ëª¨ì–‘ ìì´ ê°€ì„ì— í™©ìƒ‰ ë‹¨í’ì„ ì´ë£¬ë‹¤. ì•”ìˆ˜ë”´ê·¸ë£¨ì´ë©° ì¢…ìëŠ” ì¡°ë¥˜ì˜ ë¨¹ì´ê°€ ë˜ê¸°ë„ í•œë‹¤. ì–‘ì§€Â·ë°°ìˆ˜ ì–‘í˜¸ í† ì–‘ì—ì„œ ê°€ì¥ ê±´ê°•í•˜ë‹¤.',
    tags:['ê³ ìƒëŒ€ê³„í†µ','ë‚´ê³µí•´ì„±','ê°€ì„ë‹¨í’'] },

  { name:'íšŒì–‘ëª©', type:'shrub', emoji:'ğŸŒ¿', lng:127.01635871534069, lat:37.48975523159393, img:'images/íšŒì–‘ëª©.jpg',
    desc:'íšŒì–‘ëª©(Buxus microphylla)ì€ ìƒë¡ ê´€ëª©. ë‚´ìŒì„±Â·ì „ì • ì ì‘ì„±ì´ ë†’ì•„ ìƒìš¸íƒ€ë¦¬ì— ì í•©í•˜ê³  ë„ì‹œ ìŠ¤íŠ¸ë ˆìŠ¤ì—ë„ ê°•í•˜ë‹¤. ì•½ì‚°ì„±Â·ë°°ìˆ˜ ì–‘í˜¸ í† ì–‘ ì„ í˜¸.',
    tags:['ìƒë¡ê´€ëª©','ì „ì •ìš©ì´','ë„ì‹œì ì‘'] },

  { name:'ë‚˜íŒ”ê½ƒ', type:'vine', emoji:'ğŸ§µ', lng:127.0182483915749, lat:37.48985863749586, img:'images/ë‚˜íŒ”ê½ƒ.jpg',
    desc:'ë‚˜íŒ”ê½ƒ(Ipomoea nil)ì€ í•œí•´ì‚´ì´ ë©êµ´. ìƒˆë²½ ê°œí™”Â·ì˜¤í›„ ë‚™í™”ì˜ ì¼ì£¼ ìŠµì„±. ì§€ì§€ë¬¼ì„ íƒ€ê³  ë¹ ë¥´ê²Œ ì‹ ì¥í•˜ë©° ìˆ˜ì§ë…¹í™”ì— ìœ ìš©.',
    tags:['í•œí•´ì‚´ì´','ìˆ˜ë¶„ê³¤ì¶©','ìˆ˜ì§ë…¹í™”'] },

  { name:'ê°•ì•„ì§€í’€', type:'grass', emoji:'ğŸŒ¾', lng:127.0182918324071, lat:37.48990172324625, img:'images/ê°•ì•„ì§€í’€.jpg',
    desc:'ê°•ì•„ì§€í’€(Setaria spp.)ì€ ë²¼ê³¼ ì¼ë…„ìƒ ì´ˆë³¸. êµë€ì§€ì—ì„œ êµ°ë½ í˜•ì„± ë¹ ë¦„. ì¢…ìëŠ” ì¡°ë¥˜Â·ì†Œí˜• í¬ìœ ë¥˜ ë¨¹ì´ìì›.',
    tags:['ë²¼ê³¼','êµë€ì§€ì„ í˜¸','ë¨¹ì´ìì›'] },

  { name:'í–¥ë‚˜ë¬´', type:'conifer', emoji:'ğŸŒ²', lng:127.01618495200916, lat:37.489376075394375, img:'images/í–¥ë‚˜ë¬´.jpg',
    desc:'í–¥ë‚˜ë¬´(Juniperus chinensis)ëŠ” ë‚´ê±´ì„±Â·ë‚´ì—¼ì„±Â·ë‚´ê³µí•´ì„±ì´ ë†’ì€ ìƒë¡ ì¹¨ì—½. í”¼í†¤ì¹˜ë“œ ë°©ì¶œë¡œ ì¹˜ìœ  ê²½ê´€ì— ê¸°ì—¬.',
    tags:['ìƒë¡ì¹¨ì—½','ë‚´ê³µí•´ì„±','í”¼í†¤ì¹˜ë“œ'] },

  { name:'ë¬´ê¶í™”', type:'flower', emoji:'ğŸŒ¸', lng:127.01656505929736, lat:37.489574270920414, img:'images/ë¬´ê¶í™”.jpg',
    desc:'ë¬´ê¶í™”(Hibiscus syriacus)ëŠ” ì—¬ë¦„~ê°€ì„ ì¥ê¸° ê°œí™” ê´€ëª©. í™”ë¶„Â·ê¿€ì´ í’ë¶€í•´ ìˆ˜ë¶„ê³¤ì¶© ìì› ì œê³µ. ë‚´ì„œÂ·ë‚´ì—´ì„±ì´ ë†’ì•„ ë„ì‹œ ì ì‘ ì–‘í˜¸.',
    tags:['ì¥ê¸°ê°œí™”','ìˆ˜ë¶„ê³¤ì¶©','êµìœ¡ì†Œì¬'] },

  { name:'ê½ƒëŒ•ê°•ë‚˜ë¬´', type:'shrub', emoji:'ğŸŒ¿', lng:127.01587000596987, lat:37.48922958271119, img:'images/ê½ƒëŒ•ê°•ë‚˜ë¬´.jpg',
    desc:'ê½ƒëŒ•ê°•ë‚˜ë¬´(Euonymus alatus)ëŠ” ì¤„ê¸° ì½”ë¥´í¬ ë‚ ê°œì™€ ê°€ì„ ë‹¨í’ì´ íŠ¹ì§•ì¸ ë‚™ì—½ ê´€ëª©. ì „ì •Â·í† ì–‘ ì ì‘ì„± ë†’ìŒ.',
    tags:['ë‚™ì—½ê´€ëª©','ê°€ì„ë‹¨í’','ì¡°ë¥˜í™•ì‚°'] },

  { name:'ë“±ë‚˜ë¬´', type:'vine', emoji:'ğŸ§µ', lng:127.01542473743132, lat:37.48941054421918, img:'images/ë“±ë‚˜ë¬´.jpg',
    desc:'ë“±ë‚˜ë¬´(Wisteria floribunda)ëŠ” í¬ë„ì†¡ì´í˜• í•˜ìˆ˜í™”ì„œë¥¼ ë³´ì´ëŠ” ë©êµ´ì„± ëª©ë³¸. ì§€ì§€ëŒ€ í•„ìš”, ë´„ ìˆ˜ë¶„ê³¤ì¶© ìì› í’ë¶€.',
    tags:['ë©êµ´ëª©ë³¸','ë´„ê½ƒ','ì „ì •ê´€ë¦¬'] },

  { name:'ë‚™ìƒí™', type:'shrub', emoji:'ğŸŒ¿', lng:127.0158917263866, lat:37.49052215529494, img:'images/ë‚™ìƒí™.jpg',
    desc:'ë‚™ìƒí™(Loropetalum spp.)ì€ ìƒë¡~ë°˜ìƒë¡ ê´€ëª©. ì‹ ì´ˆ ì ììƒ‰ ëŒ€ë¹„ê°€ ê²½ê´€ í¬ì¸íŠ¸. ì•½ì‚°ì„±Â·ë°°ìˆ˜ ì–‘í˜¸ í† ì–‘ì—ì„œ ì—½ìƒ‰ ì„ ëª….',
    tags:['ìƒë¡ê´€ëª©','ì—½ìƒ‰ë¯¸','ì•½ì‚°ì„±'] },

  { name:'ëˆˆì£¼ëª©ë‚˜ë¬´', type:'conifer', emoji:'ğŸŒ²', lng:127.01525097409979, lat:37.489660442724315, img:'images/ëˆˆì£¼ëª© ë‚˜ë¬´.jpg',
    desc:'ëˆˆì£¼ëª©(Taxus cuspidata var.)ì€ ì™œì„± ê´€ëª©í˜• ì£¼ëª©. ë‚´ìŒì„± ë†’ê³  ì „ì • ë°˜ì‘ ì¢‹ìŒ. ì¡°ì§ì— ë…ì„± ì„±ë¶„ ìˆì–´ ì„­ì·¨ ê¸ˆì§€.',
    tags:['ìƒë¡ì¹¨ì—½','ë‚´ìŒì„±','ë…ì„±ì£¼ì˜'] },

  { name:'ìŠ¤íŠ¸ë¡œë¸Œ ì£ë‚˜ë¬´', type:'conifer', emoji:'ğŸŒ²', lng:127.01584828555309, lat:37.490651411323284, img:'images/ìŠ¤íŠ¸ë¡œë¸Œ ì£ë‚˜ë¬´.jpg',
    desc:'ìŠ¤íŠ¸ë¡œë¸Œ ì£ë‚˜ë¬´(Pinus strobus)ëŠ” ë¶ë¯¸ ì›ì‚° ì¹¨ì—½ êµëª©. ë¹ ë¥¸ ìƒì¥, 5ì—½ ì†ìƒ. ì–‘ì§€Â·ë°°ìˆ˜ ì–‘í˜¸ í† ì–‘ ì„ í˜¸.',
    tags:['ì™¸ë˜ì¹¨ì—½','ë¹ ë¥¸ìƒì¥','ì–‘ì§€ì„ í˜¸'] },

  { name:'ë¯¸êµ­í°ë¶ˆë‚˜ë°©', type:'insect', emoji:'ğŸ›', lng:127.01555505993065, lat:37.48986725464802, img:'images/ë¯¸êµ­í°ë¶ˆë‚˜ë°©.jpg',
    desc:'ë¯¸êµ­í°ë¶ˆë‚˜ë°©(Hyphantria cunea) ìœ ì¶©ì´ ìì„ ì‹í•´í•˜ëŠ” ê·€í™” í•´ì¶©. ì¹œí™˜ê²½ ë°©ì œ: ì•ŒÂ·ìœ ì¶© ì¡°ê¸° ì œê±°, ìœ ì¸íŠ¸ë©, ì²œì  ë³´ì „.',
    tags:['ì™¸ë˜í•´ì¶©','ì•¼í–‰ì„±','ë°©ì œê´€ë¦¬'] },

  { name:'ë°°ë¡±ë‚˜ë¬´', type:'tree', emoji:'ğŸŒ³', lng:127.01585457314383, lat:37.489833924282536, img:'images/ë°°ë¡±ë‚˜ë¬´.jpg',
    desc:'ë°°ë¡±ë‚˜ë¬´(Lagerstroemia indica)ëŠ” ì—¬ë¦„ ì¥ê¸° ê°œí™” ì†Œêµëª©. ìˆ˜í”¼ê°€ ë§¤ëˆí•˜ê³  í™”ìƒ‰ ë‹¤ì–‘. ì–‘ì§€Â·ë°°ìˆ˜ ì–‘í˜¸ì—ì„œ ìš°ìˆ˜.',
    tags:['ì—¬ë¦„ê°œí™”','ì¥ê¸°ê°œí™”','ê²½ê´€ìˆ˜'] },

  { name:'ëŒ€ì™•ì°¸ë‚˜ë¬´', type:'tree', emoji:'ğŸŒ³', lng:127.01560736007082, lat:37.48994983338444, img:'images/ëŒ€ì™•ì°¸ë‚˜ë¬´.jpg',
    desc:'ëŒ€ì™•ì°¸ë‚˜ë¬´(Quercus mongolica var.) ëŒ€í˜• ë‚™ì—½ êµëª©. ë„í† ë¦¬ëŠ” ì¡°ë¥˜Â·ì„¤ì¹˜ë¥˜ ë¨¹ì´. ë¯¸ì†Œì„œì‹ì²˜ ì œê³µ.',
    tags:['ì°¸ë‚˜ë¬´ë¥˜','ë¨¹ì´ìì›','ì„œì‹ì²˜'] },

  { name:'ì´íŒë‚˜ë¬´', type:'tree', emoji:'ğŸŒ³', lng:127.01584333618712, lat:37.49002116197302, img:'images/ì´íŒë‚˜ë¬´.jpg',
    desc:'ì´íŒë‚˜ë¬´(Chionanthus retusus)ëŠ” ì´ˆì—¬ë¦„ ë°±í™” ë°€ì§‘ ê°œí™”(ìŒ€ë°¥ë‚˜ë¬´). ì–‘ì§€ì—ì„œ ê°œí™” ê·¹ëŒ€í™”.',
    tags:['ì´ˆì—¬ë¦„ê°œí™”','ë°±í™”ìˆ˜','ìˆ˜ë¶„ìì›'] },

  { name:'ì¡°íŒë‚˜ë¬´', type:'shrub', emoji:'ğŸŒ¿', lng:127.01570006497343, lat:37.48974030526104, img:'images/ì¡°íŒë‚˜ë¬´.jpg',
    desc:'ì¡°íŒë‚˜ë¬´(Spiraea prunifolia)ëŠ” ë´„ ë°±ìƒ‰ ì†Œí™” ë‹¤ëŸ‰. êµ°ì‹ ì‹œ ê²½ê´€ íš¨ê³¼ í¼, í† ì–‘ ì ì‘ì„± ë„“ìŒ.',
    tags:['ë‚™ì—½ê´€ëª©','ë´„ê½ƒ','êµ°ì‹'] },

  { name:'ì™•ë²šë‚˜ë¬´', type:'tree', emoji:'ğŸŒ³', lng:127.0154540057988, lat:37.489883858362916, img:'images/ì™•ë²šë‚˜ë¬´.jpg',
    desc:'ì™•ë²šë‚˜ë¬´(Prunus Ã— yedoensis) ë´„ ë™ì‹œê°œí™”ë¡œ ì¥ê´€. ê°œí™” í›„ ë¹ ë¥¸ ê´‘í•©ì„± íšŒë³µ.',
    tags:['ë²šê½ƒ','ì–‘ì§€','ìˆ˜ë¶„ê³¤ì¶©'] },

  { name:'ì¡°ë¦¿ëŒ€', type:'herb', emoji:'ğŸª´', lng:127.01528264219132, lat:37.48985933912283, img:'images/ì¡°ë¦¿ëŒ€.jpg',
    desc:'ì¡°ë¦¿ëŒ€(Sasa spp.)ëŠ” ë¿Œë¦¬ì¤„ê¸° í™•ì¥ ì§€í”¼ ì‹ë¬¼. ë°˜ê·¸ëŠ˜Â·ìŠµìœ¤ í† ì–‘ ì„ í˜¸. í† ì–‘ ìœ ì‹¤ ì–µì œ.',
    tags:['ì§€í”¼','í† ì–‘ë³´ì „','ë°˜ê·¸ëŠ˜'] },

  { name:'ê³°ì†”', type:'conifer', emoji:'ğŸŒ²', lng:127.01523569387808, lat:37.48998448489418, img:'images/ê³°ì†”.jpg',
    desc:'ê³°ì†”(Pinus thunbergii) ë‚´ì—¼ì„±Â·ë°©í’ íš¨ê³¼ íƒì›”. ê¹Šì€ ì§ê·¼ìœ¼ë¡œ ë‚´í’ì„± ë†’ìŒ.',
    tags:['ìƒë¡ì¹¨ì—½','ë‚´ì—¼ì„±','ë°©í’ë¦¼'] },

  { name:'ì£¼ëª©ë‚˜ë¬´', type:'conifer', emoji:'ğŸŒ²', lng:127.01524966097253, lat:37.48973608402413, img:'images/ì£¼ëª©ë‚˜ë¬´.jpg',
    desc:'ì£¼ëª©(Taxus cuspidata) ë‚´ìŒì„± ë†’ì€ ìƒë¡ ì¹¨ì—½. ì „ì • ê°•í•¨. ê°€ì¢…ì€ ì¡°ë¥˜ í™•ì‚°. ì¡°ì§ ë…ì„± ì£¼ì˜.',
    tags:['ìƒë¡ì¹¨ì—½','ë‚´ìŒì„±','ì¡°ë¥˜í™•ì‚°'] },

  { name:'ì„¬ì£ë‚˜ë¬´', type:'conifer', emoji:'ğŸŒ²', lng:127.0149322169118, lat:37.48995229921796, img:'images/ì„¬ì£ë‚˜ë¬´.jpg',
    desc:'ì„¬ì£ë‚˜ë¬´(Abies koreana var.) ë‹¨ì •í•œ ìˆ˜í˜•. ì„œëŠ˜Â·ë°°ìˆ˜ ì–‘í˜¸ í† ì–‘ ì„ í˜¸, ì—¬ë¦„ ê³ ì˜¨Â·ê³¼ìŠµ ì£¼ì˜.',
    tags:['ìƒë¡ì¹¨ì—½','ì •ì›ìˆ˜','ë°°ìˆ˜ì¤‘ìš”'] },

  { name:'ê³ ì–‘ì´', type:'animal', emoji:'ğŸ±', lng:127.01518785770463, lat:37.490300025433044, img:'images/ê³ ì–‘ì´.jpg',
    desc:'ê³ ì–‘ì´(Felis catus) ë„ì‹¬ ìƒíƒœê³„ì˜ ì†Œí˜• í¬ì‹ì. ì„¤ì¹˜ë¥˜Â·ê³¤ì¶©ì— ì˜í–¥. ì•¼ìƒì¡°ë¥˜ì™€ì˜ ìƒí˜¸ì‘ìš© ê´€ë¦¬ í•„ìš”.',
    tags:['ë„ì‹œí¬ì‹ì','ì˜ì—­ì„±','ì¸ê°„-ìì—°ìƒí˜¸ì‘ìš©'] },

  { name:'ë¬´ë‹¹ê±°ë¯¸', type:'spider', emoji:'ğŸ•·ï¸', lng:127.01524966097253, lat:37.49022423908822, img:'images/ë¬´ë‹¹ê±°ë¯¸.jpg',
    desc:'ë¬´ë‹¹ê±°ë¯¸(Argiope spp.) ì›í˜• ê±°ë¯¸ì¤„ì— ì¥ì‹ë¬´ëŠ¬(ì•ˆì •ê¸°). ë¹„í–‰ì„± ê³¤ì¶© í¬ì‹ìœ¼ë¡œ í•´ì¶© ì¡°ì ˆì— ê¸°ì—¬.',
    tags:['ì¤‘ê°„í¬ì‹ì','í•´ì¶©ì œì–´','ê°€ì¥ìë¦¬ì„œì‹'] },

  { name:'ì„œì–‘ë“±ê³¨ë‚˜ë¬¼', type:'herb', emoji:'ğŸª´', lng:127.01537326750969, lat:37.490295567415316, img:'images/ì„œì–‘ë“±ê³¨ë‚˜ë¬¼.jpg',
    desc:'ì„œì–‘ë“±ê³¨ë‚˜ë¬¼(Ajuga reptans) ë°˜ê·¸ëŠ˜Â·ìŠµìœ¤ í† ì–‘ ì„ í˜¸ ì§€í”¼ ì´ˆë³¸. ë´„~ì´ˆì—¬ë¦„ ë³´ë¼ í™”ì„œ. ì¡ì´ˆ ì–µì œ ë„ì›€.',
    tags:['ì§€í”¼','ë°˜ê·¸ëŠ˜','ì¡ì´ˆì–µì œ'] },

  { name:'ë¯¸êµ­ì‘¥ë¶€ìŸì´', type:'herb', emoji:'ğŸª´', lng:127.01543788001703, lat:37.49031339948604, img:'images/ë¯¸êµ­ì‘¥ë¶€ìŸì´.jpg',
    desc:'ë¯¸êµ­ì‘¥ë¶€ìŸì´(Symphyotrichum pilosum) ëŠ¦ì—¬ë¦„~ê°€ì„ ê°œí™” ë‹¤ë…„ìƒ ì´ˆë³¸. ì–‘ì§€Â·ê±´ì¡°ì—ì„œ ê°œí™”ëŸ‰ ì¦ê°€.',
    tags:['ë‹¤ë…„ìƒ','ì–‘ì§€ê±´ì¡°','í›„ê¸°ìì›'] },

  { name:'ì˜ì‚°í™', type:'shrub', emoji:'ğŸŒ¿', lng:127.01494352465994, lat:37.49031136301812, img:'images/ì˜ì‚°í™.jpg',
    desc:'ì˜ì‚°í™(Rhododendron indicum) ìƒë¡ì„± ì² ì­‰ë¥˜. ì•½ì‚°ì„±Â·ë°°ìˆ˜ ì–‘í˜¸ í† ì–‘ì—ì„œ ì—½ìƒ‰Â·ê°œí™” ìš°ìˆ˜.',
    tags:['ìƒë¡ê´€ëª©','ì‚°ì„±í† ì–‘','ë´„ê°œí™”'] },

  { name:'ì‚¬ì² ë‚˜ë¬´', type:'shrub', emoji:'ğŸŒ¿', lng:127.0160114348763, lat:37.49031962975003, img:'images/ì‚¬ì² ë‚˜ë¬´.jpg',
    desc:'ì‚¬ì² ë‚˜ë¬´(Euonymus japonicus) ìƒë¡ ê´€ëª©. ë‚´ê³µí•´ì„± ë†’ê³  ì „ì • ê°•í•¨. ê²½ê³„ ì‹ì¬ë¡œ ë¹ˆìš©.',
    tags:['ìƒë¡ê´€ëª©','ê²½ê³„ì‹ì¬','ë‚´ê³µí•´ì„±'] },

  { name:'ì¸¡ë°±ë‚˜ë¬´', type:'conifer', emoji:'ğŸŒ²', lng:127.0151258507945, lat:37.49053043110234, img:'images/ì¸¡ë°±ë‚˜ë¬´.jpg',
    desc:'ì¸¡ë°±ë‚˜ë¬´(Platycladus orientalis) ì›ì¶”í˜• ìƒë¡ ì¹¨ì—½. ìƒìš¸íƒ€ë¦¬Â·ë¶„ë¦¬ ì‹ì¬ë¡œ í™œìš©.',
    tags:['ìƒë¡ì¹¨ì—½','ì›ì¶”í˜•','ìƒìš¸íƒ€ë¦¬'] },

  { name:'ëª¨ê³¼ë‚˜ë¬´', type:'tree', emoji:'ğŸŒ³', lng:127.01490185011437, lat:37.49046429740851, img:'images/ëª¨ê³¼ë‚˜ë¬´.jpg',
    desc:'ëª¨ê³¼ë‚˜ë¬´(Chaenomeles sinensis) ë´„ ê½ƒÂ·ê°€ì„ ì—´ë§¤ ê´€ìƒê°€ì¹˜. í–¥ ê°•í•œ ì—´ë§¤ëŠ” ë¬¸í™”ì  ìì›.',
    tags:['ì—´ë§¤ìˆ˜','ë´„ê½ƒ','ë¬¸í™”ìì›'] },

  { name:'ê°ë‚˜ë¬´', type:'tree', emoji:'ğŸŒ³', lng:127.01549571238183, lat:37.49057176463056, img:'images/ê°ë‚˜ë¬´.jpg',
    desc:'ê°ë‚˜ë¬´(Diospyros kaki) ê°€ì„ ì£¼í™©ìƒ‰ ì—´ë§¤. ì–‘ì§€Â·ì˜¨ë‚œ í™˜ê²½ì—ì„œ ê²°ì‹¤ ì•ˆì •.',
    tags:['ê³¼ì‹¤ìˆ˜','ê°€ì„ê²°ì‹¤','ê´€ì°°ì†Œì¬'] },

  { name:'ëŠí‹°ë‚˜ë¬´', type:'tree', emoji:'ğŸŒ³', lng:127.0147872451164, lat:37.49042709718026, img:'images/ëŠí‹°ë‚˜ë¬´.jpg',
    desc:'ëŠí‹°ë‚˜ë¬´(Zelkova serrata) í† ì¢… ë‚™ì—½ êµëª©. ë„“ì€ ìˆ˜ê´€ìœ¼ë¡œ ê·¸ëŠ˜ ì œê³µ, ë‚´ê³µí•´ì„± ë†’ìŒ.',
    tags:['í† ì¢…êµëª©','ê·¸ëŠ˜ì œê³µ','ë‚´ê³µí•´ì„±'] }
];

/* 5) ë§ˆì»¤ + íŒì—… ìƒì„± */
items.forEach(item=>{
  const el = document.createElement('div');
  el.className = `marker ${typeToClass[item.type] || 'tree'}`;
  el.title = item.name;
  el.textContent = item.emoji || 'ğŸ“';

  const popup = new mapboxgl.Popup({
    offset:18,maxWidth:"340px",closeButton:true,closeOnClick:false
  }).setHTML(`
    <div class="popup">
      <h3>${item.name}</h3>
      <img src="${encodeURI(item.img)}" alt="${item.name}">
      <div>${item.desc}</div>
      <div class="tags">${(item.tags||[]).map(t=>`<span>#${t}</span>`).join(' ')}</div>
    </div>
  `);

  const marker = new mapboxgl.Marker(el).setLngLat([item.lng,item.lat]).setPopup(popup).addTo(map);
  markers.push({marker,item});
  markerByName[item.name] = {marker,item};
});

/* 6) ìë™ íˆ¬ì–´ */
function closeAllPopups(){
  markers.forEach(({marker})=>{
    const p = marker.getPopup && marker.getPopup();
    if(p) p.remove();
  });
}
function flyAndOpen(name,dwellMs=5000){
  const ref = markerByName[name];
  if(!ref) return Promise.resolve();
  const {item,marker} = ref;
  map.flyTo({center:[item.lng,item.lat],zoom:19,pitch:60,bearing:map.getBearing(),duration:2000,essential:true});
  return new Promise(res=>{
    setTimeout(()=>{ closeAllPopups(); const p=marker.getPopup&&marker.getPopup(); if(p) p.addTo(map); setTimeout(res,dwellMs); },2000);
  });
}
function haversine(lng1,lat1,lng2,lat2){
  const R=6371000,toRad=d=>d*Math.PI/180;
  const dLat=toRad(lat2-lat1), dLng=toRad(lng2-lng1);
  const a=Math.sin(dLat/2)**2+Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLng/2)**2;
  return 2*R*Math.asin(Math.sqrt(a));
}
function buildNearestRoute(startName){
  const route=[],vis=new Set();
  let cur=markerByName[startName]?.item; if(!cur) return route;
  route.push(startName); vis.add(startName);
  for(let k=0;k<items.length-1;k++){
    let best=null,bestD=Infinity;
    for(const it of items){
      if(vis.has(it.name)) continue;
      const d=haversine(cur.lng,cur.lat,it.lng,it.lat);
      if(d<bestD){bestD=d;best=it;}
    }
    if(!best) break;
    route.push(best.name); vis.add(best.name); cur=best;
  }
  return route;
}
const routeA = [
  'ì€í–‰ë‚˜ë¬´','ëŒ€ì™•ì°¸ë‚˜ë¬´','ëŠí‹°ë‚˜ë¬´','ê³°ì†”','ìŠ¤íŠ¸ë¡œë¸Œ ì£ë‚˜ë¬´','ì„¬ì£ë‚˜ë¬´','ì£¼ëª©ë‚˜ë¬´','í–¥ë‚˜ë¬´','ì¸¡ë°±ë‚˜ë¬´',
  'ë°°ë¡±ë‚˜ë¬´','ì™•ë²šë‚˜ë¬´','ê°ë‚˜ë¬´','ëª¨ê³¼ë‚˜ë¬´','ì´íŒë‚˜ë¬´',
  'íšŒì–‘ëª©','ê½ƒëŒ•ê°•ë‚˜ë¬´','ì˜ì‚°í™','ì‚¬ì² ë‚˜ë¬´','ë‚™ìƒí™','ì¡°íŒë‚˜ë¬´',
  'ê°•ì•„ì§€í’€','ì„œì–‘ë“±ê³¨ë‚˜ë¬¼','ë¯¸êµ­ì‘¥ë¶€ìŸì´','ì¡°ë¦¿ëŒ€',
  'ë‚˜íŒ”ê½ƒ','ë“±ë‚˜ë¬´',
  'ë¯¸êµ­í°ë¶ˆë‚˜ë°©','ë¬´ë‹¹ê±°ë¯¸',
  'ê³ ì–‘ì´'
];
const tour={running:false};
async function runRoute(names){ tour.running=true; for(const n of names){ if(!tour.running) break; await flyAndOpen(n,5000);} tour.running=false; }

/* 7) ë²„íŠ¼ ì—°ê²° */
document.getElementById('btn-tour-A').onclick=()=>{ if(!tour.running){ closeAllPopups(); runRoute(routeA);} };
document.getElementById('btn-tour-B').onclick=()=>{ if(!tour.running){ closeAllPopups(); runRoute(buildNearestRoute('ëŠí‹°ë‚˜ë¬´'));} };
document.getElementById('btn-tour-stop').onclick=()=>{ tour.running=false; closeAllPopups(); };

</script>
</body>
</html>
